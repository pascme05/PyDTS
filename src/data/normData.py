#######################################################################################################################
#######################################################################################################################
# Title:        PyDTS (Python Deep Timeseries Simulation)
# Topic:        Black-Box Modeling
# File:         normData
# Date:         03.11.2023
# Author:       Dr. Pascal A. Schirmer
# Version:      V.0.1
# Copyright:    Pascal Schirmer
#######################################################################################################################
#######################################################################################################################

#######################################################################################################################
# Import libs
#######################################################################################################################
# ==============================================================================
# Internal
# ==============================================================================

# ==============================================================================
# External
# ==============================================================================
import numpy as np


#######################################################################################################################
# Function
#######################################################################################################################
def normData(X, y, setupDat, inv):
    ###################################################################################################################
    # MSG IN
    ###################################################################################################################
    print("INFO: Normalise Data")

    ###################################################################################################################
    # Initialisation
    ###################################################################################################################
    # ==============================================================================
    # Parameters
    # ==============================================================================
    if setupDat['weightNorm'] == 0:
        maxX = setupDat['normMaxX']
        maxY = setupDat['normMaxY']
        minX = setupDat['normMinX']
        minY = setupDat['normMinY']
        avgX = setupDat['normAvgX']
        avgY = setupDat['normAvgY']
        sigX = setupDat['normVarX']
        sigY = setupDat['normVarY']
    else:
        maxX = np.nanmax(setupDat['normMaxX']) * np.ones(len(setupDat['normMaxX']))
        maxY = np.nanmax(setupDat['normMaxY']) * np.ones(len(setupDat['normMaxY']))
        minX = np.nanmin(setupDat['normMinX']) * np.ones(len(setupDat['normMinX']))
        minY = np.nanmin(setupDat['normMinY']) * np.ones(len(setupDat['normMinY']))
        avgX = np.nanmax(setupDat['normAvgX']) * np.ones(len(setupDat['normAvgX']))
        avgY = np.nanmax(setupDat['normAvgY']) * np.ones(len(setupDat['normAvgY']))
        sigX = np.nanmax(setupDat['normVarX']) * np.ones(len(setupDat['normVarX']))
        sigY = np.nanmax(setupDat['normVarY']) * np.ones(len(setupDat['normVarY']))

    ###################################################################################################################
    # Calculation
    ###################################################################################################################
    # ==============================================================================
    # Input
    # ==============================================================================
    try:
        # ------------------------------------------
        # Min/Max
        # ------------------------------------------
        if setupDat['inpNorm'] == 1:
            if inv == 1:
                X = X * (maxX - minX) + avgX
            else:
                X = (X - avgX) / (maxX - minX)

        # ------------------------------------------
        # 0/1
        # ------------------------------------------
        elif setupDat['inpNorm'] == 2:
            if inv == 1:
                X = X * (maxX - minX) + minX
            else:
                X = (X - minX) / (maxX - minX)

        # ------------------------------------------
        # Avg/Sig
        # ------------------------------------------
        elif setupDat['inpNorm'] == 3:
            if inv == 1:
                X = X * sigX + avgX
            else:
                X = (X - avgX) / sigX

        # ------------------------------------------
        # None
        # ------------------------------------------
        else:
            X = X
    except:
        print("WARN: Input normalisation failed")

    # ==============================================================================
    # Output
    # ==============================================================================
    try:
        # ------------------------------------------
        # Min/Max
        # ------------------------------------------
        if setupDat['outNorm'] == 1:
            if inv == 1:
                y = y * (maxY - minY) + avgY
            else:
                y = (y - avgY) / (maxY - minY)

        # ------------------------------------------
        # 0/1
        # ------------------------------------------
        elif setupDat['outNorm'] == 2:
            if inv == 1:
                y = y * (maxY - minY) + minY
            else:
                y = (y - minY) / (maxY - minY)

        # ------------------------------------------
        # Avg/Sig
        # ------------------------------------------
        elif setupDat['outNorm'] == 3:
            if inv == 1:
                y = y * sigY + avgY
            else:
                y = (y - avgY) / sigY

        # ------------------------------------------
        # None
        # ------------------------------------------
        else:
            y = y
    except:
        print("WARN: Output normalisation failed")

    ###################################################################################################################
    # Return
    ###################################################################################################################
    return [X, y]
